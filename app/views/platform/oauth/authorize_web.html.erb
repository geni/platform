<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta content="width=device-width; initial-scale=1.0; maximum-scale=1.0; minimum-scale=1.0; user-scalable=0;" name="viewport">
  
  <%= stylesheet_link_tag '/platform/stylesheets/components.css' %>
  <%= stylesheet_link_tag '/platform/stylesheets/layout.css' %>
</head>
<body>
 
 
 	<div class="page_hd hd ">
    <div href="/" class="i logo module"></div>
  </div>
  <div class="page_bd bd ">


	<div class="platform-authorize-outer outset">
		<div class="inner">
    
			<div class="module mbl">
				<div class="mbs" style="font-size:16px;"><%=trl("[bold: {application}] would like permission to access your Geni account.","", :application => @client_application.name)%></div>
				<div class="quiet">
					<%= trl("Only allow access if you trust this application with your Geni Information.") %>
				</div>
			</div>
			
			<div class="module pal mbl">
				<div class="line">
					<div class="platform-authorize__app-info-panel">
						<div class="platform-authorize__app-info-panel-inner">
							<div class="mbm">
								<%= image_tag(@client_application.logo_url) %>
							</div>
							<div class="mbs">
							<%= link_to(h(@client_application.name), {:action => :view, :id => @client_application.id}, :target => "_blank") %><br>
							</div>
							<div>
							 <%= platform_app_rank_tag(@client_application, 95) %>
							</div>				
						</div>
					</div>
					<div class="platform-authorize__access-panel">
						<div class="media mrl">
							<%=image_tag(Platform::Config.user_mugshot(Platform::Config.current_user), :class => "img")%>
							<div class="bd">
								<h4><%= trl("This application will have access to:") %></h4>
								<p class="quiet mbl">
									<%=trl("Your name, profile picture, gender, family, photos and any other information available through your user account.")%>
								</p>
              <%- if @client_application.tos_required? -%>
                <div class='platform-authorize__tos-row' style='display:none;'>
                  <%= tr('You must approve the Terms of Service and Privacy Policy', 'Client application error text') %>
                </div>
              <%- end -%>
								<div class='platform-authorize__button-row'>
								 <button class="blue super large button" onClick="$('authorize').value = 1; doAccept()">
										<%=trl('Authorize', 'Client application action label')%>
								 </button>
								 <button class="white super large button"  onClick="$('authorize').value = 0; $('auth_form').submit()">
										<%=trl("Cancel", 'Client application action label')%>
								 </button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
				
			<div class="module small quiet prose checkbox-wrapper">
      <%- if @client_application.tos_required? -%>
        <input id='tos-accepted' type='checkbox'/>
      <%- end -%>
      <%= tr(@client_application.terms_statement_tr_label, "",
             :application  => @client_application.name,
             :link_tos     => lambda{|text| link_to(text, @client_application.terms_of_service_url, :target => "_blank") },
             :link_privacy => lambda{|text| link_to(text, @client_application.privacy_policy_url,   :target => "_blank") }) -%>
			</div>

		</div>
	</div>

</div>
<%= render :partial => "authorize_form" %>



<script>
  function $(element_id) {
    if (typeof element_id == 'string') return document.getElementById(element_id);
    return element_id;
  }
	
  function doAccept() {
    if( $('tos-accepted') && !$('tos-accepted').checked ) {
      $$('.platform-authorize__tos-row').first().show();
      return false;
    } else {
      $('auth_form').submit();
    }
  }

</script>  

  </div>


</body>
</html>
