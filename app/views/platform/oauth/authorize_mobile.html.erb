<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta content="width=device-width; initial-scale=1.0; maximum-scale=1.0; minimum-scale=1.0; user-scalable=0;" name="viewport">
  
	<link href="/stylesheets/components.css?1309982554" media="" rel="stylesheet" type="text/css">
	<link href="/stylesheets/layout.css?1307049673" media="" rel="stylesheet" type="text/css">
	<link href="/stylesheets/common.css?1310061236" media="" rel="stylesheet" type="text/css">
	<link href="/stylesheets/temp.css?1305836734" media="" rel="stylesheet" type="text/css">
	<link href="/stylesheets/header.css?1309297014" media="" rel="stylesheet" type="text/css">
    
</head>
<body>
 <div class="page_hd hd pvm phl">
 	  <div style="float:right;padding-top:5px;font-weight:bold;">
		  <%=link_to(tr("Not {user}?", "", :user => [Platform::Config.current_user, :name]), :controller => "/login", :action => :out, :display => params[:display], :client_id => @client_application.id)%>
		</div>
    <div href="/" class="i logo"></div>
  </div>
  <div class="page_bd bd">

	<div class="mhm mvl">
    
		<div class="module mbl">
			<span class="mbn h4"><%=trl("[bold: {application}] would like permission to access your Geni account.","", :application => @client_application.name)%></span>
			<span class="quiet">
				<%= trl("Only allow access if you trust this application with your Geni Information.") %>
			</span>
		</div>
		
		<div class="module mbm">
			<div class="bd">
				<h4><%= trl("{app} is requesting permission to do the following:", "", :app => @client_application.name) %></h4>
				<div class="media profile_thumb">
						<%=image_tag(Platform::Config.user_mugshot(Platform::Config.current_user), :class => "img")%>
						<div class="bd">
							<p class="quiet ">
								<%=tr("")%>
								<%=tr("Your name, profile picture, gender, family, photos and any other information available through your user account.")%>
							</p>
			
						</div>
					</div>
			</div>
		</div>
		
  <%- if @client_application.tos_required? -%>
    <div class='platform-authorize__tos-row' style='display:none;'>
      <%= tr('You must approve the Terms of Service and Privacy Policy', 'Client application error text') %>
    </div>
  <%- end -%>

		<div class='txt_c mbl platform-authorize__button-row'>
		 <button class="blue super large button" onClick="$('authorize').value = 1; doAccept()">
				<%=trl('Authorize', 'Client application action label')%>
		 </button>
		 <button class="white super large button"  onClick="$('authorize').value = 0; $('auth_form').submit()">
				<%=trl("Cancel", 'Client application action label')%>
		 </button>
		</div>
		
		<div class="module small quiet prose mvl">
      <%- if @client_application.tos_required? -%>
        <input id='tos-accepted' type='checkbox'/>
      <%- end -%>
      <%= tr(@client_application.terms_statement_tr_label, "",
             :application  => @client_application.name,
             :link_tos     => lambda{|text| link_to(text, @client_application.terms_of_service_url, :target => "_blank") },
             :link_privacy => lambda{|text| link_to(text, @client_application.privacy_policy_url,   :target => "_blank") }) -%>
		</div>
            
	</div>

</div>
<%= render :partial => "authorize_form" %>

	<script>
	  function $(element_id) {
	    if (typeof element_id == 'string') return document.getElementById(element_id);
	    return element_id;
	  }
	
  function doAccept() {
    if( !$('tos-accepted').checked ) {
      $$('.platform-authorize__tos-row').first().show();
      return false;
    } else {
      $('auth_form').submit();
    }
  }

	</script>  
</body>
</html>
